<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Content-Language" content="ja">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="author" content="OpenHSP3 Project">
	<meta name="keywords" content="HSP,HSP3,Hot Soup Processor,更新情報,アップデート">
	<meta name="description" content="HSPの更新情報を掲載">
	<link href="../main.css" rel="stylesheet" type="text/css" media="all">
	<title>HSP3.7 新機能ハイライト</title>
</head>
<body>
	<div id="CONTAINER">
		<!-- ヘッダー -->
		<p id="COPY">HSP : Hot Soup Processor ver3.7 / onion software 1997-2022(c)</p>
		<img src="hsp3ttl.jpg" alt="title" width="640" height="200">
		<h1>HSP3.7 新機能ハイライト</h1>

		<!-- 目次 -->
		<ol>
			<li><a href="#HSP3UPDATE">HSP3.7アップデート概要</a></li>
			<li><a href="#HSP3C">コンパクト(hsp3c)版ランタイムについて</a></li>
			<li><a href="#HGIMG4TOOL">HGIMG4ツールの更新について</a></li>
			<li><a href="#HSP3DISH_DRAW">HSP3Dishのboxf描画命令の修正について</a></li>
			<li><a href="#PACKFILE_DPM">DPM2形式による複数ファイルのパックについて</a></li>
			<li><a href="#HSP3DISH_HELPER">HSP3Dishサポートツールについて</a></li>
			<li><a href="#DOTFW">珠音ドットフレームワークについて</a></li>
			<li><a href="#OGGFILE">oggファイルのオンメモリ再生について</a></li>
			<li><a href="#CELLOAD">celload命令のID割り当てについて</a></li>
		</ol>
		
		<!-- 本文 -->
	<h2 id="HSP3UPDATE">HSP3.7のアップデート概要</h2>
		<p>
		HSP3.7は、特に変更を意識することなく、HSP3.6と同様にお使い頂けます。
		HSP3.7で変更された項目の概要は、以下の通りです。詳細な修正事項は<a href="history.txt">「history.txt」</a>を参照してください。
		</p>

		<dl>

			<dt>
			DPMファイル及びファイル暗号化埋め込み機能の更新
			</dt><br>
			<dd>
			<p>
			HSP3.6までのファイル埋め込み機能(PACKFILE)ではファイル名の長さに制約やフォルダの階層構造をサポートしていませんでした。<br>
			HSP3.7では、ファイル埋め込み機能を更新してフォルダ構造や暗号化の刷新、HGIMG4への対応などを行っています。
			また、HSP3Dishでの使用や対応ツールの強化などにより、今までよりも便利にご使用いただけます。
			詳しくは、<a href="hspprog.htm#PACKFILE">プログラミング・マニュアル</a>をご覧ください。<br>
			</p>
			</dd>

			<dt>
			HSP3Dish android版のビルド機能修正
			</dt><br>
			<dd>
			<p>
			<a href="hsp3dish_prog.htm">HSP3Dish</a>のandroid向けビルド機能を大きく変更しています。<br>
			HSP3.6までのantツールを使用したビルドから、Gradleを使用した最新のビルド方法に変更されています。
			これにより、Google Playストアでの配信に必要となるaab形式のファイルをビルドすることが可能になります。<br>
			今まで通りデバイスへの変換をサポートするHSP3Dish Helperツールをご利用頂けますが、既存のプロジェクトとは互換性がないため、新規に作成する必要があるのでご注意ください。<br>
			また、新しいHSP3Dish Helperでは、androidエミュレータの作成・実行、リリースバージョンの管理、ビルド後の自動実行などの機能が追加されています。
			</p>
			</dd>

			<dt>
			HSP3不具合の修正
			</dt><br>
			<dd>
			<p>
			HSP3インタプリアコア部分で、HSP3.6リリース後に報告されたいくつかの不具合が修正されています。<br>
			モジュール型配列変数の代入時の不具合、#constで定義されたdouble型実数値の有効桁数が少なかった不具合などが修正されています。
			</p>
			</dd>

			<dt>
			レガシー機能の廃止
			</dt><br>
			<dd>
			<p>
			HSP3のランタイムやツールで古くなったもののいくつかを同梱終了しています。<br>
			「コンパクト(hsp3c)版ランタイム」及び「Peasエディタ」はHSP3.6までのサポートとなります。
			</p>
			</dd>

		</dl>


	<h2 id="HSP3C">コンパクト(hsp3c)版ランタイムについて</h2>
		<p>
		HSP3.6までのコンパクト版ランタイム(hsp3c)は、HSP3.7から運用を廃止しています。<br>
		コンパクト版ランタイムは、Windows 98以降の動作をサポートするために古いコンパイラを使用していましたが、
		ファイルサイズの僅かな削減以外のメリットが少なく、現行のOS上で実行の効率が悪いことから同梱を終了ることとしました。<br>
		hsp3cを使用していたユーザーは、引き続き標準のHSP3ランタイムをご使用頂くようお願い致します。
		</p>



	<h2 id="HGIMG4TOOL">HGIMG4ツールの更新について</h2>
		<p>
		HGIMG4について以下の修正を行っています。
		</p>
		<dl>

			<dt>
			HGIMG4ツール(gpbconv)の機能修正
			</dt><br>
			<dd>
			<p>
			<a href="hgimg4.html">HGIMG4</a>の3Dモデル変換に使用するHGIMG4ツール(gpbconv)の機能修正を行っています。<br>
			変換された3Dデータのプレビュー機能が実装されているほか、
			3Dモデル変換時のマテリアル名に日本語など英文字以外を含む場合、正しく認識されないことがあるため、マテリアル名修正に関するオプション指定を追加しました。
			また、モデルファイルとは別にアニメーションデータをFBXファイルで用意したものを結合するためのオプションが追加されています。
			</p>
			</dd>

		</dl>


	<h2 id="HSP3DISH_DRAW">HSP3Dishのboxf描画命令の修正について</h2>
		<p>
		HSP3.7β2からWindows版のHSP3Dishでboxf命令の塗りつぶし範囲が標準ランタイムと異なる不具合を修正しています。<br>
		それまで右と下の1ドットがいままで描画されていなかったものを正常な動作に修正しています。
		ほとんどの場合問題は出ないものと考えていますが、それまでの動作を基準に作成していたスクリプトで描画の結果が異なる場合がありますのでご了承ください。
		システムリクエストにより、従来の描画に戻すことも可能です。その場合は、以下のようにsetreq命令を記述してください。
		</p>
		<pre>
			setreq SYSREQ_OLDBOXF,1		; HSP3.6のboxf動作を維持する
		</pre>
		<p>
		</p>


	<h2 id="PACKFILE_DPM">DPM2形式による複数ファイルのパックにいて</h2>
		<p>
		HSP3.7からパックして埋め込まれるデータの形式がDPM2という新しいものになりました。
		これにより、いままでよりも制約の少ない自由なファイルのパック、暗号化を利用することができます。
		( ただし、HSP3.6までの.dpmファイルとは互換性がなくなっています。以前に作られた.dpmは再度作成するようにしてください。)<br>
		HSP3.7では、複数の.dpmファイルを同時に使用することができるほか、ファイル名の長さやサイズの制限が緩和されています。
		<br>
		詳しくは、<a href="hspprog.htm#PACKFILE">「ファイルのパックと暗号化」</a>の項目を参照してください。
		</p>


	<h2 id="HSP3DISH_HELPER">HSP3Dishサポートツールにいて</h2>
		<p>
		HSP3Dishでのプロジェクト設定やdpmファイルなどの作成をサポートするツールが新規で追加されています。
		以下のサポートツールは、HSP3Dish HelperやHSPスクリプトエディタから起動することができます。
		</p>
		<pre>
		ツール名                         起動方法
		--------------------------------------------------------------------------
		Dish P Helper                    HSP3Dish Helper Androidタブから
		#packoptリスト作成ツール         スクリプトエディタ「ツール」メニューから
		#packリスト作成ツール            スクリプトエディタ「ツール」メニューから
		Android/iOSアイコン作成ツール    HSP3Dish Helper Android/iOSタブから
		</pre>
		<p>
		</p>


	<h2 id="DOTFW">珠音ドットフレームワークにいて</h2>
		<p>
		「珠音（たまね）ドットフレームワーク」は、ドット絵のHSP3オフィシャル素材とHSP3Dish上で使用できるライブラリのセットです。
		ゲームに特化したシンプルな命令セットとオールインワンの素材パッケージで手軽にレトロスタイルの自作ゲームを作り始めることが可能です。 作成したゲームは、WindowsだけでなくWebやラズパイ、Linux、android、iOSなどで発表することが可能です。
		サンプルスクリプトが「sample/dotfw」フォルダに用意されていますのでお試しください。
		<br>
		詳しくは、<a href="dotfw.html">珠音ドットフレームワークマニュアル</a>を参照してください。
		</p>


	<h2 id="OGGFILE">oggファイルのオンメモリ再生について</h2>
		<p>
		HSP3.7β4から、HGIMG3及びhspoggプラグインを使用したoggファイル再生をオンメモリで行うよう修正されています。
		<br>
		これにより、暗号化されたdpmファイルや埋め込みデータを含めてHSP3が扱うファイルシステムからの読み込みが可能になりました。従来までのストリーミングによる再生を行う方法も選択できますので、状況に応じてお使い頂けます。
		</p>
		<pre>
		ファイル種別                     再生方法
		--------------------------------------------------------------------------
		wave形式(拡張子.wav)             オンメモリ再生(埋め込みデータ対応)
		ogg vorbis形式(拡張子.ogg)       オンメモリ再生(埋め込みデータ対応)
		ogg vorbis形式(拡張子.s)         ストリーミング再生(埋め込みデータ非対応)
		</pre>
		<p>
		詳しくは、<a href="hspogg.txt">hspoggマニュアル</a>を参照してください。
		</p>


	<h2 id="CELLOAD">celload命令のID割り当てについて</h2>
		<p>
		HSP3.7β4から、celload命令で読み込みウインドウIDの指定を省略(またはマイナス値)して自動的にIDを割り当てる際の動作が修正されています。<br>
		ceload命令のウィンドウIDパラメーターが省略された場合には、すでに読み込まれている画像ファイルと同一のファイル名を指定した場合、 読み込まれているウインドウIDが再利用されます。
		この動作は、標準のHSP3ランタイム、HSP3Dishランタイムを含むすべてのプラットフォームで適用されます。
		<br>
		これにより、重複した画像を読み込もうとした場合に、リソースを共有してメモリを節約することができます。
		外部のモジュール内で画像を使用する場合や、ソースを再利用した場合にリソースの重複を防ぎます。
		(既存のバージョンでは、重複した画像が読み込まれても常に新しいIDが割り当てられています。)
		<br>
		この変更により、既存のスクリプトで重複した画像ファイルを複数の異なるウインドウIDに読み込んでいる場合などで、IDの割り当てに不一致が起こる可能性があります。
		ウインドウIDの再利用をしたくない場合は、「celload "a.png",celid_auto」のようにパラメーターにcelid_auto(または-1)を指定してください。
		<br>
		詳しくは、<a href="hspprog.htm#CEL_FUNCTION">CEL関連命令について</a>を参照してください。
		</p>


		<!-- フッター -->
		<ul id="FOOTER">
			<li><a href="#CONTAINER">このページの1番上に戻る</a></li>
			<li><a href="../index.htm">ドキュメントの一覧に戻る</a></li>
			<li><a href="https://hsp.tv/">Go to HSPTV page</a></li>
		</ul>
		<a href="https://www.onionsoft.net/hsp/">
			<img src="img/onibtn.gif" width="147" height="50" alt="ONION software" id="ONIBTN">
		</a>
	</div><!-- container -->
</body>
</html>
